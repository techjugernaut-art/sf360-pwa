<app-main-nav [isProcessing]="isProcessing">
  <app-breadcrumb-actions class="full-width" [pageHeaderOptions]="pageHeaderOptions"
    (dataRefreshed)="onDataRefreshed($event)">
    <div mainAction>
      <button mat-raised-button [matMenuTriggerFor]="mainActionsMenu" color="accent">
        ACTIONS
      </button>
      <mat-menu #mainActionsMenu="matMenu">
        <a mat-menu-item [routerLink]="['/products/create']" *ngIf="!isPartner">
          <span>Add Product</span>
        </a>
        <a mat-menu-item *ngIf="!isPartner" [routerLink]="['/products/upload']">Bulk Excel Upload</a>
        <button mat-menu-item *ngIf="!isPartner && !isGroupProducts" (click)="onDuplicateProductMerge()">Merge
          Duplicated Products</button>
        <a mat-menu-item *ngIf="!isGroupProducts" [routerLink]="['/products/generate-barcodes']">Preview Barcodes </a>
        <button mat-menu-item (click)="downloadProductsAsExcelFile()">Download Products </button>
      </mat-menu>

    </div>
  </app-breadcrumb-actions>

  <div class="row " *ngIf="!productsSearched" [@fadeInOutAnimation]>
    <div class="col-md-6 col-lg-6">
      <mat-card class="mb-3">
        <mat-card-content>
          <div class="dashboard-card-row">
            <div class="card-icon-left mr-2">
              <div class="icon-card icon-card-green">
                <i class="fe fe-shopping-cart text-white"></i>
              </div>
            </div>
            <div class="card-content-right">
              <h3 class="dashboard-card-text-default mb-0">{{totalSupplierValue | number: '1.2-2'}}</h3>
              <p class="dashboard-card-title mb-0">Total Supplier Value</p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <div class="col-md-6 col-lg-6">
      <mat-card class="mb-3">
        <mat-card-content>
          <div class="dashboard-card-row">
            <div class="card-icon-left mr-2">
              <div class="icon-card icon-card-pink">
                <i class="fe fe-credit-card text-white"></i>
              </div>
            </div>
            <div class="card-content-right">
              <h3 class="dashboard-card-text-default mb-0">{{totalUnitPriceValue | number: '1.2-2'}}</h3>
              <p class="dashboard-card-title mb-0">Total Unit Price Value</p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

  </div>


  <mat-card>

    <mat-card-content class="ml-3 mr-3">
      <app-table-header-actions [tableHeaderOptions]="tableHeaderOption" (searchTextChanged)="searchProducts($event)">

        <button mat-stroked-button [matMenuTriggerFor]="actionsMenu" color="primary" *ngIf="!selection.isEmpty()">
          ACTIONS
        </button>
        <mat-menu #actionsMenu="matMenu">
          <button mat-menu-item *ngIf="!isPartner" [matMenuTriggerFor]="productCategorySubmenu">Product
            Category</button>
        </mat-menu>
        <mat-menu #productCategorySubmenu="matMenu">
          <button mat-menu-item *ngIf="!isPartner && isGroupProducts" [disabled]="selection.isEmpty()"
            (click)="removeSelectedProductsFromCategory()">Remove {{selection?.selected?.length}} product(s)</button>
          <button mat-menu-item *ngIf="!isPartner" [disabled]="selection.isEmpty()"
            (click)="onAssignProductsToProductGroup()">Assign {{selection?.selected?.length}} product(s)</button>
        </mat-menu>
      </app-table-header-actions>
      <div class="table-responsive">

        <table class="table dataTable no-footer table-border-bottom">
          <thead>
            <tr role="row">
              <th class="wd-15p">
                <mat-checkbox class="list-checkbox" (change)="$event ? masterToggle() : null"
                  [checked]="selection.hasValue() && isAllSelected()"
                  [indeterminate]="selection.hasValue() && !isAllSelected()"></mat-checkbox>
                Name
              </th>
              <th class="wd-15p">Quantity</th>
              <th class="wd-15p">Sell. Price</th>
              <th class="wd-25p">Product Category</th>
              <th class="wd-15p">Shop</th>
              <th class="wd-10p">Expiry Date</th>
              <th class="wd-25p">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngIf="!isProcessing && shopProducts?.length <= 0">
              <td colspan="10" class="text-center">
                <app-empty-record></app-empty-record>
              </td>
            </tr>
            <tr *ngFor="let product of shopProducts">
              <td>
                <mat-checkbox class="list-checkbox" (click)="$event.stopPropagation()"
                  (change)="$event ? selection.toggle(product?.id) : null"
                  [checked]="selection.isSelected(product?.id)"></mat-checkbox>
                {{product?.name}}
              </td>
              <td *ngIf="!product?.is_service">
                <span>{{product?.new_quantity | number: '1.2-2'}} {{product?.price_list | getBaseUnitName :
                  product?.base_unit_name}}</span>
              </td>
              <td *ngIf="product?.is_service">
                N/A
              </td>
              <td>{{product?.currency}} {{product?.selling_price}}</td>
              <td>{{product?.product_group?.name}}</td>
              <td>{{product?.myshop?.business_name}}</td>
              <td>{{product?.new_expiry_date }}</td>
              <td class="text-center">

                <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
                  <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                  <button mat-menu-item *ngIf="!product?.is_service && !isPartner"
                    (click)="editStock(product, editStockActions?.INCREASE_STOCK)"><span>Increase Stock</span></button>
                  <button mat-menu-item *ngIf="!product?.is_service && !isPartner"
                    (click)="editStock(product, editStockActions?.DECREASE_STOCK)"><span>Decrease Stock</span></button>
                  <button mat-menu-item *ngIf="!product?.is_service && !isPartner"
                    (click)="editStock(product, editStockActions?.EDIT_QUANTITY)"><span>Set Quantity</span></button>
                  <button mat-menu-item *ngIf="!isPartner" (click)="changePriceList(product)"><span>Update Price
                      List</span></button>
                  <a mat-menu-item [routerLink]="['/products/edit', product?.id, product?.name]" *ngIf="!isPartner">
                    <span>Edit Product</span>
                  </a>
                  <a mat-menu-item [routerLink]="['/products', product?.id, product?.name]">View Detail </a>
                  <button mat-menu-item (click)="uploadProductImage(product)" *ngIf="!isPartner">
                    <span>Upload Product Image</span>
                  </button>
                  <button mat-menu-item
                    *ngIf="product?.myshop?.storefrontmall_name !== '' && product?.myshop?.storefrontmall_name !== null && product?.myshop?.storefrontmall_name !== undefined"
                    (click)="onGenratePromoCodeQR(product)"><span>Generate Promo Code QR</span></button>
                </mat-menu>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <app-pagination [dataSet]="shopProducts" [nextPage]="nextPage" [prevPage]="prevPage" [totalPage]="totalPage"
        [requestPayload]="requestPayload" [requestMethod]="'POST'" (pageChanged)="onPageChanged($event)"
        [isProcessing]="isProcessing"></app-pagination>
    </mat-card-content>

  </mat-card>

</app-main-nav>



<!-- Edit Stock Modal -->
<div class="modal fade" id="modalEditStock" tabindex="-1" role="dialog" aria-labelledby="modal-edit-stock"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title invoice-modal-title" id="modal-title-notification">
          {{editStockModalTitle | titlecase}}
        </h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="btnCloseEditStockModal">
          <span aria-hidden="true">Ã—</span>
        </button>
      </div>
      <mat-progress-bar mode="indeterminate" *ngIf="isProcessingEditStock"></mat-progress-bar>
      <form [formGroup]="increaseOrDecreaseStockFormGroup"
        (ngSubmit)="increaseOrDereaseStockForAProduct(increaseOrDecreaseStockFormGroup?.value)">
        <div class="modal-body">
          <div class="row">

            <mat-form-field class="col-12">
              <input type="tel" matInput placeholder="Quantity" formControlName="quantity" decimalOnly>
              <mat-hint class="text-danger" *ngIf="!quantity?.valid && quantity?.touched">Please enter Quantity
              </mat-hint>
            </mat-form-field>
          </div>
        </div>
        <div class="modal-footer">
          <button mat-raised-button color="primary"
            [disabled]="increaseOrDecreaseStockFormGroup?.invalid || isProcessingEditStock" type="submit">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- End of Edit Stock Modal -->
