<app-main-nav [isProcessing]="isProcessing">
  <app-breadcrumb-actions class="full-width" [pageHeaderOptions]="pageHeaderOptions"
    (dataRefreshed)="onDataRefreshed($event)"></app-breadcrumb-actions>


  <mat-card class="mt-4">
    <mat-card-content >
      <mat-tab-group mat-stretch-tabs>
        <!-- Product general information -->
        <mat-tab active="true">
          <ng-template mat-tab-label>
            General Information
          </ng-template>
          <!-- General information -->
          <div class="table-responsive mt-3">
            <table class="table row table-borderless w-100 m-0 profile-edit-table">
              <tbody class=" p-0">
                <tr>
                  <td><strong>Product Name :</strong> {{productDetail?.name}}
                  </td>
                </tr>
                <tr>
                  <td><strong>Promo Type :</strong> {{productDetail?.promo_type | removeUnderScore}}

                  </td>
                </tr>

                <tr>
                  <td><strong>Promo Code Usage :</strong>
                    <span *ngIf="productDetail?.code_usage_type === promoCodeUsageTypes?.SINGLE" >UNIQUE CODE FOR EACH CUSTOMER
                  </span>
                  <span *ngIf="productDetail?.code_usage_type === promoCodeUsageTypes?.MULTIPLE">1 CODE FOR MULTIPLE CUSTOMERS
                  </span>
                  </td>
                </tr>
                <tr>
                  <td><strong>Start Date :</strong>
                    {{productDetail?.start_date | date : 'medium'}}
                  </td>
                </tr>
                <tr>
                  <td><strong>End Date :</strong>
                    {{productDetail?.end_date | date : 'medium'}}
                  </td>
                </tr>
                <tr>
                  <td><strong>Promo Has Expired :</strong>
                    <mat-checkbox class="ml-2" [checked]="productDetail?.end_date | hasExpired" [disabled]="true"></mat-checkbox>
                  </td>
                </tr>
                <tr>
                  <td><strong>Date Created :</strong> {{productDetail?.date_created | date: 'medium'}}
                  </td>
                </tr>



              </tbody>

            </table>
          </div>

          <!-- End of General Information -->
        </mat-tab>
        <!-- End Product general information -->


        <!-- Shop Info tab -->
        <mat-tab>
          <ng-template mat-tab-label>
            Shop Info
          </ng-template>
          <div class="table-responsive mt-3">
            <table class="table row table-borderless w-100 m-0 profile-edit-table">
              <tbody class=" p-0">
                <tr>
                  <td><strong>Business Name :</strong> {{productDetail?.myshop?.business_name}}
                  </td>
                </tr>
                <tr>
                  <td><strong>Business Reg Number :</strong>
                    {{productDetail?.myshop?.business_registration_number | uppercase}}
                  </td>
                </tr>
                <tr>
                  <td><strong>Business Type :</strong> {{productDetail?.myshop?.business_type | titlecase}}
                  </td>
                </tr>
                <tr>
                  <td><strong>Location :</strong> {{productDetail?.myshop?.location | titlecase}}
                  </td>
                </tr>


              </tbody>
              <tbody class="p-0">
                <tr>
                  <td><strong>Administrator :</strong> {{productDetail?.myshop?.administration_name | titlecase}}
                  </td>
                </tr>

                <tr>
                  <td><strong>VAT Number :</strong> {{productDetail?.myshop?.vat_number}}
                  </td>
                </tr>
                <tr>
                  <td><strong>TAX Number :</strong> {{productDetail?.myshop?.tax_number}}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </mat-tab>
        <!-- End of Shop Info tab -->

        <!-- Promo Codes Info tab -->
        <mat-tab class="clearfix">
          <ng-template mat-tab-label>
            <div>
              Promo Codes
              <mat-progress-bar mode="indeterminate" *ngIf="isProcessingPromoCodes"  ></mat-progress-bar>
            </div>
          </ng-template>

          <app-table-header-actions [tableHeaderOptions]="tableHeaderOption">
            <button mat-button mat-stroked-button color="primary" type="button" (click)="onAddPromoCode()"><i class="fe fe-plus mr-1"></i> ADD PROMO CODE</button>
          </app-table-header-actions>
          <div class="table-responsive mt-3">
            <table class="table dataTable no-footer table-border-bottom">
              <thead>
                <tr>
                  <th class="wd-15p">code</th>
                  <th class="wd-15p">Rate Type</th>
                  <th class="wd-15p">Rate Value</th>
                  <th class="wd-10p">Redeemed</th>
                  <th class="wd-25p">Date Redeemed</th>
                  <th class="wd-25p">Actions</th>

                </tr>
              </thead>
              <tbody *ngIf="promoCodes?.length <= 0">
                <tr>
                  <td colspan="10" class="text-center"><app-empty-record></app-empty-record></td>
              </tr>
              </tbody>
              <tbody  *ngFor="let order of promoCodes">

                <tr>
                  <td >{{order?.code}}</td>
                  <td>{{order?.rate_type}}</td>
                  <td><span *ngIf="order?.rate_type === promoCodeRateTypes?.FLAT" >{{productDetail?.myshop?.currency}}</span> {{order?.rate_value | number: '1.2-2'}}<span *ngIf="order?.rate_type === promoCodeRateTypes?.PERCENTAGE">%</span></td>
                  <td>
                    <mat-icon *ngIf="!order?.redeemed" >remove</mat-icon>
                    <mat-icon *ngIf="order?.redeemed">done</mat-icon>
                  </td>
                  <td>{{order?.date_redeemed | date: 'medium'}}</td>
                  <td class="text-center">

                    <button class="btn btn-primary btn-sm" (click)="onRemovePromoCode(order?.id)">
                      <i class="fe fe-trash-2"></i>
                    </button>
                  </td>
                </tr>

              </tbody>
            </table>
          </div>
          <app-pagination [dataSet]="promoCodes" [nextPage]="nextPage" [prevPage]="prevPage" [totalPage]="promoCodes?.length"
            [requestPayload]="salesOrdersRequestPayload" [requestMethod]="'POST'" (pageChanged)="onPageChanged($event)"
            [isProcessing]="isProcessingPromoCodes"></app-pagination>
        </mat-tab>
        <!-- End of Promo Codes Info tab -->

  <!-- Sales Orders tab -->
  <mat-tab >
    <ng-template mat-tab-label>
      Sales Orders
    </ng-template>
    <div class="table-responsive">
      <table class="table dataTable no-footer table-border-bottom">
        <thead>
          <tr>
            <th class="wd-15p">Order #</th>
            <th class="wd-15p">Customer</th>
            <th class="wd-15p">Promo Code</th>
            <th class="wd-15p">Discount</th>
            <th class="wd-15p">Amount</th>
            <th class="wd-15p">Payment Method</th>
            <th class="wd-10p">Shop</th>
            <th class="wd-25p">Date Placed</th>
            <th class="wd-25p">Actions</th>

          </tr>
        </thead>
        <tbody>
          <tr *ngIf="salesOrders?.length <= 0">
            <td colspan="10" class="text-center"><app-empty-record></app-empty-record></td>
          </tr>
          <tr *ngFor="let order of salesOrders">
            <td>{{order?.order_code}}</td>
            <td>{{order?.customer?.phone_number}} <span
                *ngIf="order?.customer?.phone_number !== '' && order?.customer?.phone_number !== null && order?.customer?.name !== '' && order?.customer?.name !== null">/</span>
              {{order?.customer?.name}}</td>
            <td>{{order?.promo_code}}</td>
            <td>{{order?.currency}} {{order?.discount | number: '1.2-2'}}</td>
            <td>{{order?.currency}} {{order?.total_amount | number: '1.2-2'}}</td>
            <td>{{order?.payment_method}}</td>
            <td>{{order?.myshop?.business_name | titlecase}}</td>
            <td>{{order?.date_placed | date: 'medium'}}</td>
            <td class="text-center">

              <button class="btn btn-primary btn-sm"  (click)="viewOrderDetails(order)" data-toggle="modal"
                data-target="#modalSalesOrdersDetail">
                <i class="fe fe-eye"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
      <app-pagination [dataSet]="salesOrders" [nextPage]="stockRecordNextPage" [prevPage]="stockRecordPrevPage" [totalPage]="stockRecordTotalPage"
        [requestPayload]="salesOrdersRequestPayload" [requestMethod]="'POST'" (pageChanged)="onSalesOrdersPageChanged($event)"
        [isProcessing]="isProcessing"></app-pagination>
        </div>
  </mat-tab>
  <!-- End of Sales orders tab -->
      </mat-tab-group>

    </mat-card-content>

  </mat-card>

</app-main-nav>




<!-- Sales Orders Details Modal -->
<div class="modal fade" id="modalSalesOrdersDetail" tabindex="-1" role="dialog" aria-labelledby="modal-notification"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title invoice-modal-title" id="modal-title-notification">
          Order #: {{saleOrderDetail?.order_code}}
        </h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">Ã—</span>
        </button>
      </div>
      <div class="modal-body" id="salesOrderModalBody">
        <div class="logo-img text-center pb-3">
          <img src="../assets/img/logos/dark-green.png" alt="invoice-logo-img" class="invoice-logo-img">
        </div>
        <div class="mb-0">
          <div class="row">
            <div class="col-6 invoice-detail">
              <h4 class="title"><strong>Order #: {{saleOrderDetail?.order_code}}</strong></h4>
              <p class="mb-0 detail"><strong>{{saleOrderDetail?.myshop?.business_name | titlecase}}</strong></p>
              <p class="mb-0 detail">{{saleOrderDetail?.myshop?.location | titlecase}}</p>
              <p class="mb-0 detail">Date Placed: {{saleOrderDetail?.date_placed | date: 'medium'}}</p>
              <p class="mb-0 detail">Payment Method: {{saleOrderDetail?.payment_method}}</p>

            </div>
            <div class="col-6 text-right invoice-detail">
              <h4 class="title"><strong>Customer Info: </strong></h4>
              <p class="mb-0 detail"><strong>{{saleOrderDetail?.customer?.name | titlecase}}</strong></p>
              <p class="mb-0 detail">Phone: {{saleOrderDetail?.customer?.phone_number}}</p>
              <p class="mb-0 detail">Email: {{saleOrderDetail?.customer?.email}}</p>

            </div>

          </div>
          <!-- end row -->

          <div class="row mt-4">
            <div class="col-md-12">
              <div class="table-responsive">
                <table class="table m-t-30 text-nowrap  table-border-bottom invoice-table">
                  <thead class="thead-primary">
                    <tr>
                      <th>#</th>
                      <th>Description</th>
                      <th>Quantity</th>
                      <th class="text-right">Amount({{saleOrderDetail?.currency}})</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of salesOrderItems">
                      <td>{{item?.id}}</td>
                      <td>{{item?.my_product?.name}}</td>
                      <td>{{item?.new_quantity}}</td>
                      <td class="text-right">{{item?.subtotal | number: '1.2-2'}}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-xl-4 col-12 offset-xl-8 invoice-footer">
              <p class="text-right mt-3 font-weight-600">Sub-total: {{saleOrderDetail?.currency}}
                {{saleOrderDetail?.gross_total | number: '1.2-2'}}</p>
              <p class="text-right font-weight-600">Discout: {{saleOrderDetail?.discount}}</p>
              <p class="text-right font-weight-600">VAT: {{saleOrderDetail?.vat_value}}</p>
              <hr>
              <h4 class="text-right grand-total">Grand Total : {{saleOrderDetail?.currency}}
                {{saleOrderDetail?.total_amount | number: '1.2-2'}}</h4>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12 invoice-detail">
              <h4 class="title"><strong>Agent</strong></h4>
              <p class="mb-0 detail"><strong>{{saleOrderDetail?.author?.first_name | titlecase}},
                  {{saleOrderDetail?.author?.last_name | titlecase}}</strong></p>
              <p class="mb-0 detail">Phone: {{saleOrderDetail?.author?.phone_number}}</p>
              <p class="mb-0 detail">Email: {{saleOrderDetail?.author?.email}}</p>
            </div>
          </div>

        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" (click)="exportAsPDF()"><i class="fa fa-file-pdf"></i> Download As PDF</button>
      </div>
    </div>
  </div>
</div>
<!-- End of Sales Orders Details Modal -->
